# CLAUDE.md
基于Tushare和Streamlit的交互式公募基金量化分析平台
## 1. 角色与目标
你是一位顶尖的量化金融开发者和数据科学家，精通使用Python进行金融数据分析、模型构建和可视化。你的任务是为一名基金投资者或研究员，构建一个功能全面、界面友好的Streamlit Web应用，用于对中国的公募基金进行多维度、可视化的量化评估。
核心目标： 让用户能够通过输入基金代码，快速获取该基金的全景式分析报告。报告需无缝整合基金的基本面信息、运营数据、核心业绩指标、全面的技术分析信号和风险评估，并以高度交互性和可视化的方式呈现。
## 2. 技术栈要求
    - 数据接口 (Data API): Tushare Pro API。代码中应预留输入Tushare Pro Token的位置。
    - 后端/数据处理 (Backend/Data Processing): Python, Pandas, NumPy。强烈建议使用 pandas-ta 库来计算技术指标。
    - 前端/仪表盘 (Frontend/Dashboard): Streamlit。
    - 可视化 (Visualization): Plotly Express。
## 3. 应用核心功能与结构
应用设计为单页仪表盘模式，左侧为控制面板，右侧为分析结果展示区。
### 3.1. 侧边栏控制面板 (Sidebar Controls)
    - Tushare Pro Token输入: st.sidebar.text_input，类型为 password。
    - 基金代码选择: st.sidebar.text_input，让用户输入基金代码 (例如 510300.SH)。
    - 日期范围选择: st.sidebar.date_input，默认周期为过去三年。
    - 分析基准选择: st.sidebar.selectbox，包含沪深300 (000300.SH)、中证500 (000905.SH) 等。
    - 基础技术分析参数:
        - 移动平均线 (MA): 用户自定义短期(默认20)和长期(默认60)均线周期。
        - 相对强弱指数 (RSI): 用户自定义RSI计算周期(默认14)。
    - ⭐ 高级技术指标选择:
        - 使用 st.sidebar.multiselect 创建一个多选框，让用户从以下列表中选择感兴趣的高级技术指标进行可视化。
        - 指标列表: BOLL (布林带), MACD (平滑异同移动平均线), KDJ (随机指标), CCI (顺势指标), DMI (动向指标), BBI (多空指标), TRIX (三重指数平滑移动平均线), ATR (真实波动率), OBV (能量潮), MFI (资金流量指标)。
### 3.2. 主界面结果展示区 (Main Dashboard Area)
#### ⭐ 模块一：基金概览与核心信息
此模块使用 st.tabs 分页展示基金的多维度信息。
    - Tab 1: 核心业绩
        - 核心指标看板: 使用 st.columns 和 st.metric 展示：区间累计收益率, 年化收益率, 年化波动率, 最大回撤, 夏普比率, 卡玛比率。
    - Tab 2: 基本资料
        - 数据来源: fund_basic 接口。
        - 展示内容: 使用列表或卡片形式清晰展示基金全称、管理人、托管人、投资类型、成立日期、业绩比较基准。
    - Tab 3: 基金经理
        - 数据来源: fund_manager 接口。
        - 展示内容: 以表格形式展示历任/现任基金经理的姓名、任职起始/结束日期，并可展开查看其详细简历。
    - Tab 4: 规模与分红
        - 规模数据来源: fund_share 接口。
        - 分红数据来源: fund_div 接口。
    - 展示内容:
        - 使用 st.metric 展示最新的基金份额（规模）。
        - 绘制一张基金份额历史变化的面积图。
        - 以表格形式展示该基金的历史分红记录（每股派息、权益登记日、除息日）。
#### 模块二：净值与通道指标可视化
- 图表标题: "基金净值走势与通道指标"
- 图表要求: 使用 Plotly 创建一个交互式图表，包含：
    1. 主图: 基金与基准的累计净值走势线。
    2. 叠加层:
        - 用户自定义的短期和长期移动平均线 (MA)。
        - 如果用户在侧边栏选择了 BOLL，则在此图上叠加布林带的上、中、下轨。
    3. 信号标记: 标记出金叉和死叉的发生点。
    4. 回撤可视化: 高亮标记出历史最大回撤区间。
#### 模块三：风险与相对强弱分析
- 图表一：滚动波动率 ("滚动年化波动率 (60日)")
- 图表二：相对强弱指数 (RSI) (包含30/70超卖/超买线)
#### 模块四：高级技术指标分析
- 逻辑: 此模块根据用户在侧边栏多选框中的选择，动态生成相应的技术指标图表。每个图表都应是独立的子图，使用 Plotly 创建。
- 图表示例:
    - 如果选择了 MACD: 绘制 DIF 线、DEA 线和 MACD 柱状图。
    - 如果选择了 KDJ: 绘制 K, D, J 三条曲线。
    - （以此类推） 为用户选择的其他指标创建独立的、清晰的可视化图表。
#### 模块五：年度收益表现
- 图表标题: "各年度收益率对比"
- 内容: 绘制条形图，对比基金与基准的历年年度收益率。
## 4. 数据获取与处理建议
- 数据源:
    - 核心行情: 使用 Tushare Pro 的 fund_nav 或 fund_daily 接口获取基金的日度数据。
    - 基本面数据: 调用 fund_basic, fund_manager, fund_share, fund_div 接口获取补充信息。
    - 基准数据: 使用 index_daily 获取基准指数的日线数据。
- 指标计算:
    - 关键步骤: 强烈建议使用 pandas-ta 库来计算技术指标。
    - 实现方法: 在获取到基金的日线数据DataFrame后，调用 df.ta.macd()、df.ta.kdj() 等函数附加指标列。
    - 数据完整性: 代码应能优雅处理 fund_daily 或 fund_nav 返回数据字段不全的情况。
## 5. 代码实现建议
- 模块化函数: 结构保持 load_data(), calculate_metrics(), plot_charts() 的形式。应为每个Tushare接口的数据获取创建一个独立的函数。
- 数据缓存: 必须对所有数据加载和计算函数使用 @st.cache_data，以确保在调整UI时应用能流畅响应，避免重复请求API。
- 错误处理: 完善的错误处理，对无效的基金代码、Token错误、数据获取失败等情况给出明确提示。
- 依赖文件: 在代码注释中列出所需库：streamlit, pandas, numpy, plotly, tushare, pandas-ta。
请根据这份提示词，一个模块化的项目。
